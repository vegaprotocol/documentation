---
sidebar_position: 2
title: Set up validator node
hide_title: false
---
import NetworkParameter from '@site/src/components/NetworkParameter';

## Configure the components and run it
Once you have all the executables you need, you must configure them to run correctly and to connect to the existing network. 

This will also initiate the node wallet software, which you'll be prompted to create a password for. You'll need to set another passphrase for the wallet itself, in the next section.

First, generate the default configuration files for Vega and Tendermint. You can then alter those to the specific requirements.

The below command will create home paths (if they don't already exist) and generate the configuration in the homes you chose. 

```
vega init --home=YOUR_HOME_PATH --tendermint-home=YOUR_TENDERMINT_HOME_PATH validator
```

To update your node configuration, such as to set up ports for the APIs, edit the config file:

```
YOUR_HOME_PATH/config/node/config.toml
```

## Set up the node wallet
Each validator node requires two cryptographic wallets to operate properly:
* Ethereum wallet: Used to sign transactions going through the ERC20 bridge
* Vega wallet: Used to sign transaction sent by validators in the Vega network

The public key of the Tendermint node also needs to be saved in the node wallet.

All this information needs to be checked in properly before starting the node. When the network starts or a node is added to the validator set, this information will be checked against the transaction used to register the node on the network. Any incorrect set-up will stop the node from joining the network.

You need to generate or import the wallet information for Tendermint, Vega and Ethereum. See below for [Ethereum wallet instructions](#ethereum-wallet).

:::note
You will be asked for a passphrase for your node wallet, which you created when you initialised Vega. Make sure to save this passphrase in a text file, somewhere secure, as it allows you to unlock the node wallet.

The following command should output the path of the main configuration file. Feel free to open and change settings if needed.
:::

### Set up the Vega wallet
We recommend you use an isolated key. Read the guide on how to isolate Vega wallet keys: [Isolate keys](../../tools/vega-wallet/cli-wallet/latest/guides/isolate-keys.md)

Give the node access to the key using the following command: 
```
vega nodewallet import --chain=vega --home="YOUR_VEGA_HOME_PATH" --wallet-passphrase-file="file/containing/account/passphrase" --wallet-path="PATH_FOR_YOUR_WALLET_HOME"
```

Alternatively you can create a new Vega wallet and save it in the node wallet:
```
vega nodewallet generate --chain=vega --home="YOUR_VEGA_HOME_PATH" --wallet-passphrase-file="file/containing/account/passphrase"
```

:::info
You can verify the information saved in your node wallet using the following command:
```
vega nodewallet --home="YOUR_VEGA_HOME_PATH" show 
```
:::

### Save your Tendermint public key
To save the Tendermint public key in your node wallet, look in your tendermint config `YOUR_TENDERMINT_HOME_PATH/config/priv_validator_key.json` for your tendermint public key, and import it.

```
vega nodewallet import --chain=tendermint --tendermint-pubkey="YOUR_TENDERMINT_PUBKEY"
```

If your Tendermint node is set up to use `tmkms`, then refer to the [tmkms documentation ↗](https://github.com/iqlusioninc/tmkms) to get your public key.

:::note
If you are not using tmkms (e.g: the default software keys generated by tendermint, run the following command instead:
```
vega nodewallet import --chain=tendermint --home="YOUR_VEGA_HOME_PATH" --tendermint-home="YOUR_TENDERMINT_HOME_PATH"
```
This will read the Tendermint keys from the configuration path, and set up your node wallet properly.
:::

### Set up your Ethereum wallet
Vega supports two types of Ethereum wallet: you can either register a wallet available from a clef instance or import a keystore file (e.g: create with `geth account`).

#### Using clef
To set up your clef instance please refer to the [clef documentation ↗](https://geth.ethereum.org/docs/clef/tutorial).

Set the address of your clef instance in the Vega configuration (`YOUR_VEGA_HOME/config/node/config.toml`):
```Toml
[NodeWallet]
  Level = "Info"
  [NodeWallet.ETH]
    Level = "Info"
    Address = ""
    ClefAddress = "http://your.clef.instance.network:3334"
```

Alternatively you can run the following command and specify the flag:
```
--eth.clef-address="http://your.clef.instance.network:3334"
```

Then run the following command:

```shell
vega nodewallet import --chain=ethereum --home="YOUR_HOME_PATH" --clef-account-address="0xYOUR_WALLET_ADDRESS"
```

#### Using a keystore account file
You can either import an existing keystore or create a new one. (Learn how to create a keystore [using geth ↗](https://geth.ethereum.org/docs/getting-started))

Import an existing keystore using the following command:

```shell
vega nodewallet import --chain=ethereum --home="YOUR_HOME_PATH" --wallet-passphrase-file="file/containing/account/passphrase" --wallet-path="YOUR_HOME_PATH"
```

Or use the following command to create a new keystore and save it in the node wallet:

```shell
vega nodewallet generate --chain=ethereum --home="YOUR_HOME_PATH" --wallet-passphrase-file="file/containing/account/passphrase"
```

## Set up Ethereum node
In order to validate events happening on the Ethereum bridge, the Vega node needs to be connected to an Ethereum node. 

The Ethereum node address for the RPC endpoint needs to be set up in the configuration. Once you have an Ethereum node, insert the URL in `YOUR_VEGA_HOME/node/config.toml`, in the section:

```toml
[Ethereum]
    Level = "Info"
    RPCEndpoint = "INSERT_URL_HERE"
    RetryDelay = "15s"
```

## Configure Tendermint
Vega being a decentralised network, you will need an entry point to join it. This is done by connecting to one or more node in the network when you start your node. This step needs to be done manually. You will first need to reach out to another node operator in the network to get their node ID and the address of their node. 

Once you have the node information, update the tendermint config located at `YOUR_TENDERMINT_HOME/config/config.toml` and set the `persistent_peers` field under the `[p2p]` section.

Here's an example:

```
[p2p]
persistent_peers = "55b8ac477ddd6c0c9bae411dfa6ebfb46e7b4022@veganodeoperator.com:26656,2d1bbf1229bd7f8e57e89c61346ab6928d61881b@127.0.0.1:26656"
```

The persistent_peers field is a list of node id and address of node separated by a `@` character.

Then ensure the `max_packet_msg_payload_size` is at least 16384.

Under `Mempool Configuration Option`, ensure that `broadcast = true`.

### Save Tendermint genesis
To start successfully, tendermint needs the genesis file from the network you will be trying to join. This file need to be located in `YOUR_TENDERMINT_HOME/config/genesis.json`. 

You can find genesis files for network supported by the community in the [networks repository](https://github.com/vegaprotocol/networks). 

For example, to join mainnet you will need the following [genesis file](https://github.com/vegaprotocol/networks/blob/master/mainnet1/genesis.json).

## Synchronise your node

### Start node from a snapshot
[Snapshots](../how-to/use-snapshots.md): Use a recent network snapshot to start your node without having to replay the entire chain.

Once you start from a snapshot, you'll need to self-stake, and then announce the node to the network and then the community.

### Replay from genesis
To replay all history from genesis: 

You can set a genesis file when starting the node with the following command, e.g for sandbox:

```shell
vega start --home="YOUR_VEGA_HOME_PATH" --network=sandbox
```

You can now start your node by running the following command:
```vega start```

## Associate tokens to your Vega key
Before you announce your node, you will need to have <NetworkParameter frontMatter={frontMatter} param="reward.staking.delegation.minimumValidatorStake" hideName={true} formatter="governanceToken" suffix="tokens"/> Vega associated to your Vega key.

The tokens that you want to use for self-staking must be available on an Ethereum wallet, and then associated to the same Vega key you used to set up the node. 

Use the [Sepolia VEGA contract ↗](https://sepolia.etherscan.io/address/0xAe6dd14bD9313d22Cf2254F347836570Df592022#writeContract) to faucet tokens to your Ethereum key. 

Once you have tokens, associate them and nominate your node using the [token dApp ↗](https://sandbox.token.vega.xyz/staking/).

## Announce node on-chain
Use your Ethereum key to announce your node to the network.

You'll need to know the [current epoch ↗](https://sandbox.token.vega.xyz/staking), and have the following data to hand: the URL for your validator website, and URL for the avatar that will show up on the token dApp next to your node name.

```shell
vega announce_node --home="YOUR_VEGA_HOME_PATH" --info-url="YOUR_VALIDATOR_URL" --avatar-url="YOUR_AVATAR_URL" --country="UK" -- name="YOUR_NODE_NAME" --from-epoch="CURRENT_EPOCH" --submitter-address="YOUR_ETHEREUM_KEY"
```

## Nominate your node
To move on to self-staking, wait until the next epoch to see your node on the node list. 

Then, associate your tokens and nominate your node using the [token dApp ↗](https://sandbox.token.vega.xyz/staking/) or by interacting directly with the smart contract.

## Submit signature bundle
In the epoch after you announced your node, the network will build a signature bundle: proof from the network that your node can be added to the multisigControl signers.

Use the 'add signer' tool on [sandbox.tools.vega.xyz ↗](https://sandbox.tools.vega.xyz/) to submit the signature bundle. 

Once the signature bundle is accepted, your node will be able to emit signatures to control withdrawals from the bridge. 

:::caution
You need to add your node as a signer by the end of the epoch that the signature is emitted in. If you do not, the node will be demoted and removed from the signer set.
:::

## Announce node off-chain
[Create a validator profile on the forum ↗](https://community.vega.xyz/c/mainnet-validator-candidates/23) describing the experience you have, security practices and policies, how you will ensure maximum uptime, how you'll meet suitable performance standards, your communication channels for questions and the role you intend to take in Vega's governance.

Share your profile with the community, for example in [the Validators Discord channel ↗](https://discord.com/channels/720571334798737489/869236034116943903), to attract staker delegation.